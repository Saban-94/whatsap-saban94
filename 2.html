<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>××¨×›×– ×©×œ×™×˜×” - ×—.×¡×‘×Ÿ</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@400;500;700&display=swap" rel="stylesheet">
    
    <style>
        body { background-color: #f4f6f9; font-family: 'Rubik', sans-serif; overflow-x: hidden; }
        
        /* --- ×¡×¨×’×œ ×¦×“ --- */
        .sidebar {
            position: fixed; right: 0; top: 0; bottom: 0; width: 260px;
            background: #263238; color: white; padding: 20px; z-index: 1000;
            display: flex; flex-direction: column; box-shadow: -5px 0 15px rgba(0,0,0,0.1);
        }
        .brand { font-size: 1.5rem; font-weight: 900; color: #00e676; margin-bottom: 40px; text-align: center; border-bottom: 1px solid #37474f; padding-bottom: 20px; }
        
        .nav-btn {
            background: transparent; border: none; color: #b0bec5;
            padding: 12px 15px; margin-bottom: 8px; border-radius: 10px;
            text-align: right; display: flex; align-items: center; gap: 12px;
            font-size: 1rem; transition: all 0.3s;
        }
        .nav-btn:hover { background: rgba(255,255,255,0.05); color: white; transform: translateX(-5px); }
        .nav-btn.active { background: #00e676; color: #121212; font-weight: bold; box-shadow: 0 4px 15px rgba(0,230,118,0.3); }
        .nav-btn i { font-size: 22px; }

        /* --- ××–×•×¨ ×ª×•×›×Ÿ ×¨××©×™ --- */
        .main-content { margin-right: 260px; padding: 30px; }
        
        /* ×›×¨×˜×™×¡×™× ×•×˜×‘×œ××•×ª */
        .card-box { background: white; border-radius: 16px; padding: 25px; box-shadow: 0 5px 20px rgba(0,0,0,0.05); margin-bottom: 25px; }
        .section-title { font-weight: 700; color: #37474f; margin-bottom: 20px; display: flex; align-items: center; gap: 10px; }
        
        /* ×›×¤×ª×•×¨×™ ×©×™×’×•×¨ ××”×™×¨ */
        .quick-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 15px; }
        .quick-card {
            background: white; border: 1px solid #e0e0e0; border-radius: 12px; padding: 15px;
            text-align: center; cursor: pointer; transition: 0.2s; position: relative; overflow: hidden;
        }
        .quick-card:hover { border-color: #00e676; transform: translateY(-3px); box-shadow: 0 5px 15px rgba(0,0,0,0.08); }
        .qc-icon { font-size: 2rem; color: #00e676; margin-bottom: 5px; }
        .qc-name { font-weight: bold; color: #333; font-size: 0.95rem; }
        .qc-sub { font-size: 0.75rem; color: #888; }

        /* ×¡×˜×•×“×™×• ×©×™×“×•×¨ */
        .studio-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .studio-panel { background: #1e1e1e; color: white; border-radius: 16px; padding: 20px; border: 1px solid #333; }
        .studio-panel h5 { color: #aaa; font-size: 0.9rem; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 15px; border-bottom: 1px solid #333; padding-bottom: 10px; }
        .form-dark { background: #2c2c2c; border: 1px solid #444; color: white; }
        .form-dark:focus { background: #333; color: white; border-color: #00e676; box-shadow: none; }
        
        .color-selector { display: flex; gap: 10px; margin-bottom: 15px; }
        .c-dot { width: 30px; height: 30px; border-radius: 50%; cursor: pointer; border: 3px solid transparent; transition: 0.2s; }
        .c-dot.selected { border-color: white; transform: scale(1.2); }
        .bg-blue { background: #0078d4; } .bg-red { background: #d32f2f; } .bg-green { background: #2e7d32; }

        /* ×ª×¦×•×’×” ××§×“×™××” */
        .preview-box { background: #000; border-radius: 10px; padding: 20px; text-align: center; border: 2px solid #333; min-height: 150px; display: flex; flex-direction: column; justify-content: center; align-items: center; }
        .prev-ticker { width: 100%; padding: 10px; color: white; font-weight: bold; border-radius: 5px; }
        
        /* ×˜×‘×œ××•×ª */
        .table thead th { border-bottom: 2px solid #eee; color: #888; font-size: 0.85rem; }
        .table td { vertical-align: middle; }
        .status-badge { padding: 4px 8px; border-radius: 6px; font-size: 0.8rem; font-weight: bold; }
        .sb-active { background: #e8f5e9; color: #2e7d32; }

    </style>
</head>
<body>

    <div class="sidebar">
        <div class="brand"><i class="material-icons" style="vertical-align:middle">local_shipping</i> ×—.×¡×‘×Ÿ ×œ×•×’×™×¡×˜×™×§×”</div>
        
        <button class="nav-btn active" onclick="switchTab('live', this)">
            <i class="material-icons">dvr</i> ×œ×•×— ×‘×§×¨×”
        </button>
        <button class="nav-btn" onclick="switchTab('studio', this)">
            <i class="material-icons">campaign</i> ×¡×˜×•×“×™×• ×©×™×“×•×¨
        </button>
        <button class="nav-btn" onclick="switchTab('clients', this)">
            <i class="material-icons">people</i> ×××’×¨ ×œ×§×•×—×•×ª
        </button>
        <button class="nav-btn" onclick="switchTab('history', this)">
            <i class="material-icons">history</i> ××¨×›×™×•×Ÿ
        </button>
        
        <div style="margin-top:auto; font-size:0.8rem; color:#546e7a; text-align:center;">
            ××¢×¨×›×ª ×’×¨×¡×” 3.0 (Final)<br>××—×•×‘×¨ ×œ-Firebase
        </div>
    </div>

    <div class="main-content">

        <div id="tab-live" class="tab-pane">
            
            <div class="card-box">
                <div class="section-title"><i class="material-icons text-primary">rocket_launch</i> ×©×™×’×•×¨ ××”×™×¨ (×œ×§×•×—×•×ª ×§×‘×•×¢×™×)</div>
                <div id="quick-grid" class="quick-grid">
                    <div class="text-muted">×˜×•×¢×Ÿ ×œ×§×•×—×•×ª...</div>
                </div>
            </div>

            <div class="d-flex justify-content-between align-items-center mb-3">
                <h3 style="font-weight:900; color:#263238;">×”×–×× ×•×ª ×¤×¢×™×œ×•×ª</h3>
                <button class="btn btn-primary shadow" onclick="openOrderModal()">
                    <i class="material-icons" style="vertical-align:middle">add</i> ×”×–×× ×” ×™×“× ×™×ª
                </button>
            </div>

            <div class="card-box p-0 overflow-hidden">
                <table class="table table-hover mb-0">
                    <thead class="bg-light">
                        <tr>
                            <th width="10%">×ª×¢×•×“×”</th>
                            <th width="10%">×–××Ÿ</th>
                            <th width="20%">×œ×§×•×—</th>
                            <th width="20%">×›×ª×•×‘×ª</th>
                            <th width="15%">× ×”×’/×¡×•×’</th>
                            <th width="15%">×¤×¢×•×œ×•×ª</th>
                        </tr>
                    </thead>
                    <tbody id="live-table-body"></tbody>
                </table>
            </div>
        </div>

        <div id="tab-studio" class="tab-pane" style="display:none;">
            <h3 class="mb-4 fw-bold">ğŸ¨ ×¡×˜×•×“×™×• ×©×™×“×•×¨ ×‘×–××Ÿ ×××ª</h3>
            
            <div class="studio-grid">
                <div class="studio-panel">
                    <h5>×¤×¡ ×—×“×©×•×ª ×ª×—×ª×•×Ÿ (Ticker)</h5>
                    <label class="small text-muted mb-1">×ª×•×›×Ÿ ×”×”×•×“×¢×”</label>
                    <input type="text" id="news-input" class="form-control form-dark mb-3" placeholder="×”×§×œ×“ ×”×•×“×¢×” ×¨×¦×”...">
                    
                    <label class="small text-muted mb-1">×¦×‘×¢ ×¨×§×¢</label>
                    <div class="color-selector">
                        <div class="c-dot bg-blue selected" onclick="setNewsColor('blue', this)"></div>
                        <div class="c-dot bg-red" onclick="setNewsColor('red', this)"></div>
                        <div class="c-dot bg-green" onclick="setNewsColor('green', this)"></div>
                    </div>

                    <div class="preview-box mb-3">
                        <div id="prev-news" class="prev-ticker" style="background:#0078d4;">...</div>
                    </div>

                    <button class="btn btn-outline-light w-100" onclick="updateNews()">
                        <i class="material-icons" style="vertical-align:middle">send</i> ×¢×“×›×Ÿ ×¤×¡ ×—×“×©×•×ª
                    </button>
                </div>

                <div class="studio-panel" style="border-color:#00e676;">
                    <h5 style="color:#00e676; border-color:#00e676;">MEGA POPUP (××ª×¤×¨×¥)</h5>
                    
                    <div class="row g-2 mb-2">
                        <div class="col-8">
                            <label class="small text-muted">×›×•×ª×¨×ª</label>
                            <input id="pop-title" class="form-control form-dark" placeholder="×”×•×“×¢×” ×—×©×•×‘×”">
                        </div>
                        <div class="col-4">
                            <label class="small text-muted">××™×™×§×•×Ÿ</label>
                            <select id="pop-icon" class="form-select form-dark">
                                <option value="campaign">ğŸ“¢</option>
                                <option value="warning">âš ï¸</option>
                                <option value="verified">âœ…</option>
                                <option value="celebration">ğŸ‰</option>
                            </select>
                        </div>
                    </div>
                    
                    <label class="small text-muted">×ª×•×›×Ÿ ×”×”×•×“×¢×”</label>
                    <textarea id="pop-body" class="form-control form-dark mb-2" rows="2" placeholder="××œ×œ ×—×•×¤×©×™..."></textarea>
                    
                    <label class="small text-muted">×¢×¨×›×ª × ×•×©×</label>
                    <select id="pop-theme" class="form-select form-dark mb-4">
                        <option value="neon">ğŸ’ × ×™××•×Ÿ ×™×¨×•×§ (×¢×ª×™×“× ×™)</option>
                        <option value="gold">ğŸ¥‡ ×–×”×‘ ×™×•×§×¨×ª×™</option>
                        <option value="alert">ğŸš¨ ××“×•× ××”×‘×”×‘ (×—×™×¨×•×)</option>
                    </select>

                    <div class="d-flex gap-2">
                        <button class="btn btn-success flex-fill fw-bold" onclick="togglePopup(true)">
                            <i class="material-icons" style="vertical-align:middle">play_arrow</i> ×©×“×¨ ×œ××¡×š
                        </button>
                        <button class="btn btn-danger flex-fill fw-bold" onclick="togglePopup(false)">
                            <i class="material-icons" style="vertical-align:middle">stop</i> ×›×‘×” ×©×™×“×•×¨
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div id="tab-clients" class="tab-pane" style="display:none;">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h3>× ×™×”×•×œ ×œ×§×•×—×•×ª</h3>
                <button class="btn btn-success" onclick="openClientModal()">+ ×œ×§×•×— ×—×“×©</button>
            </div>
            <div class="card-box">
                <table class="table">
                    <thead><tr><th>×©× ×œ×§×•×—</th><th>×›×ª×•×‘×ª ×§×‘×•×¢×”</th><th>×¡×•×’ ×‘×¨×™×¨×ª ××—×“×œ</th><th>×¤×¢×•×œ×•×ª</th></tr></thead>
                    <tbody id="clients-table"></tbody>
                </table>
            </div>
        </div>

        <div id="tab-history" class="tab-pane" style="display:none;">
            <h3>××¨×›×™×•×Ÿ ×‘×™×¦×•×¢×™×</h3>
            <div class="alert alert-info small">×”×–×× ×•×ª ×©×¡×•×× ×• ×›"×¡×•×¤×§×•". ××—×™×§×” ××›××Ÿ ×”×™× ×¡×•×¤×™×ª.</div>
            <div class="card-box">
                <table class="table table-striped">
                    <thead><tr><th>×ª××¨×™×š ×™×¢×“</th><th>×œ×§×•×—</th><th>×›×ª×•×‘×ª</th><th>× ×”×’</th><th>× ×™×”×•×œ</th></tr></thead>
                    <tbody id="history-table"></tbody>
                </table>
            </div>
        </div>

    </div>

    <div class="modal fade" id="orderModal">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title">×˜×•×¤×¡ ×”×–×× ×”</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="orderForm">
                        <input type="hidden" id="o-id">
                        <div class="row g-2 mb-2">
                            <div class="col-4"><label>××¡' ×ª×¢×•×“×”</label><input id="o-oid" class="form-control" type="number"></div>
                            <div class="col-8"><label>×©× ×œ×§×•×—</label><input id="o-name" class="form-control" required></div>
                        </div>
                        <div class="mb-2">
                            <label>×›×ª×•×‘×ª (×§×¨×™×˜×™ ×œ××¤×”)</label>
                            <input id="o-addr" class="form-control" placeholder="×¢×™×¨, ×¨×—×•×‘ ×•××¡×¤×¨">
                        </div>
                        <div class="row g-2 mb-2">
                            <div class="col-6"><label>× ×”×’</label><input id="o-drv" class="form-control"></div>
                            <div class="col-6"><label>×¡×•×’</label>
                                <select id="o-type" class="form-select">
                                    <option>×× ×•×£ 10 ××˜×¨</option>
                                    <option>×× ×•×£ 15 ××˜×¨</option>
                                    <option>××›×•×œ×” 8 ×§×•×‘</option>
                                    <option>××›×•×œ×” 24 ×§×•×‘</option>
                                    <option>××©××™×ª ×—×•××¨×™×</option>
                                </select>
                            </div>
                        </div>
                        <div class="row g-2 mb-3">
                            <div class="col-6"><label>×ª××¨×™×š</label><input type="date" id="o-date" class="form-control"></div>
                            <div class="col-6"><label>×©×¢×”</label><input type="time" id="o-time" class="form-control"></div>
                        </div>
                        <button type="submit" class="btn btn-primary w-100">×©××•×¨ ×•×¢×“×›×Ÿ ××¡×›×™×</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="clientModal">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-success text-white">
                    <h5 class="modal-title">×”×•×¡×¤×ª ×œ×§×•×— ×œ×××’×¨</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="clientForm">
                        <div class="mb-2"><label>×©× ×œ×§×•×—</label><input id="c-name" class="form-control" required></div>
                        <div class="mb-2"><label>×›×ª×•×‘×ª ×§×‘×•×¢×”</label><input id="c-addr" class="form-control"></div>
                        <div class="mb-3"><label>×¡×•×’ ××•×¢×“×£</label>
                            <select id="c-type" class="form-select">
                                <option>×× ×•×£ 10 ××˜×¨</option>
                                <option>××›×•×œ×” 8 ×§×•×‘</option>
                                <option>××©××™×ª ×—×•××¨×™×</option>
                            </select>
                        </div>
                        <button type="submit" class="btn btn-success w-100">×©××•×¨ ×œ×©×™×’×•×¨ ××”×™×¨</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, updateDoc, deleteDoc, setDoc, doc, onSnapshot, query, orderBy } 
        from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // ×”×’×“×¨×•×ª Firebase
        const config = { apiKey: "AIzaSyBGYsZylsIyeWudp8_SlnLBelkgoNXjU60", projectId: "app-saban94-57361", appId: "1:275366913167:web:f0c6f808e12f2aeb58fcfa" };
        const db = getFirestore(initializeApp(config));

        // ××©×ª× ×™× ×’×œ×•×‘×œ×™×™×
        let allOrders = [];
        let newsColor = 'blue';

        // --- 1. × ×™×”×•×œ ×”×–×× ×•×ª ×•×”×™×¡×˜×•×¨×™×” ---
        onSnapshot(query(collection(db, "users"), orderBy("lastUpdate", "desc")), (snap) => {
            const liveTable = document.getElementById('live-table-body');
            const histTable = document.getElementById('history-table');
            liveTable.innerHTML = ''; histTable.innerHTML = '';
            allOrders = [];

            snap.forEach(docSnap => {
                const d = docSnap.data(); d.id = docSnap.id; allOrders.push(d);
                const oid = d.orgId || '---';

                if (d.status === 4) {
                    // ×”×™×¡×˜×•×¨×™×”
                    histTable.innerHTML += `
                        <tr>
                            <td>${d.targetDate || '-'}</td>
                            <td><b>${d.name}</b></td>
                            <td>${d.address || '-'}</td>
                            <td>${d.driverName || '-'}</td>
                            <td><button class="btn btn-sm btn-outline-danger" onclick="del('${d.id}')">××—×§</button></td>
                        </tr>`;
                } else {
                    // ×¤×¢×™×œ
                    liveTable.innerHTML += `
                        <tr>
                            <td>#${oid}</td>
                            <td class="text-primary fw-bold">${d.targetTime || '--:--'}</td>
                            <td><b>${d.name}</b></td>
                            <td><small>${d.address || '×œ×œ×'}</small></td>
                            <td><span class="badge bg-light text-dark border">${d.deliveryType}</span><br><small class="text-muted">${d.driverName||'×œ×œ× × ×”×’'}</small></td>
                            <td>
                                <button class="btn btn-sm btn-light border" onclick="edit('${d.id}')"><i class="material-icons" style="font-size:16px">edit</i></button>
                                <button class="btn btn-sm btn-success" onclick="done('${d.id}')"><i class="material-icons" style="font-size:16px">check</i></button>
                            </td>
                        </tr>`;
                }
            });
        });

        // --- 2. × ×™×”×•×œ ×œ×§×•×—×•×ª (Quick Launch) ---
        onSnapshot(collection(db, "clients"), (snap) => {
            const grid = document.getElementById('quick-grid');
            const table = document.getElementById('clients-table');
            grid.innerHTML = ''; table.innerHTML = '';

            snap.forEach(docSnap => {
                const c = docSnap.data(); c.id = docSnap.id;
                
                // ×›×¨×˜×™×¡ ×©×™×’×•×¨
                grid.innerHTML += `
                    <div class="quick-card" onclick="quickLaunch('${c.name}','${c.address}','${c.type}')">
                        <div class="qc-icon"><i class="material-icons">touch_app</i></div>
                        <div class="qc-name">${c.name}</div>
                        <div class="qc-sub">${c.type}</div>
                    </div>`;

                // ×©×•×¨×” ×‘×˜×‘×œ×”
                table.innerHTML += `
                    <tr>
                        <td><b>${c.name}</b></td>
                        <td>${c.address}</td>
                        <td>${c.type}</td>
                        <td><button class="btn btn-sm btn-danger" onclick="delClient('${c.id}')"><i class="material-icons">delete</i></button></td>
                    </tr>`;
            });
        });

        // --- 3. ×”××–× ×” ×œ×¡×˜×•×“×™×• (×¡× ×›×¨×•×Ÿ ××¦×‘ ×§×™×™×) ---
        onSnapshot(doc(db, "settings", "news"), (s) => {
            if(s.exists()){
                const d = s.data();
                document.getElementById('news-input').value = d.text || '';
                document.getElementById('prev-news').innerText = d.text || '...';
                // ×¢×“×›×•×Ÿ ×‘×—×™×¨×ª ×¦×‘×¢ ×•×™×–×•××œ×™×ª
                let col = 'blue';
                if(d.type==='alert') col='red';
                if(d.type==='success') col='green';
                setNewsColor(col, document.querySelector(`.bg-${col}`));
            }
        });

        // --- ×¤×•× ×§×¦×™×•×ª ××¢×¨×›×ª ---

        // ×˜××‘×™×
        window.switchTab = (tabId, btn) => {
            document.querySelectorAll('.tab-pane').forEach(el => el.style.display = 'none');
            document.getElementById('tab-' + tabId).style.display = 'block';
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            if(btn) btn.classList.add('active');
        };

        // ×”×–×× ×•×ª (CRUD)
        window.openOrderModal = () => {
            document.getElementById('orderForm').reset();
            document.getElementById('o-id').value = '';
            document.getElementById('o-date').valueAsDate = new Date();
            new bootstrap.Modal(document.getElementById('orderModal')).show();
        };

        window.edit = (id) => {
            const o = allOrders.find(x => x.id === id);
            document.getElementById('o-id').value = id;
            document.getElementById('o-name').value = o.name;
            document.getElementById('o-oid').value = o.orgId || '';
            document.getElementById('o-addr').value = o.address || '';
            document.getElementById('o-drv').value = o.driverName || '';
            document.getElementById('o-type').value = o.deliveryType;
            document.getElementById('o-date').value = o.targetDate || '';
            document.getElementById('o-time').value = o.targetTime || '';
            new bootstrap.Modal(document.getElementById('orderModal')).show();
        };

        window.quickLaunch = (name, addr, type) => {
            window.openOrderModal();
            document.getElementById('o-name').value = name;
            document.getElementById('o-addr').value = addr;
            document.getElementById('o-type').value = type;
        };

        document.getElementById('orderForm').onsubmit = async (e) => {
            e.preventDefault();
            const id = document.getElementById('o-id').value;
            const d = {
                name: document.getElementById('o-name').value,
                orgId: document.getElementById('o-oid').value,
                address: document.getElementById('o-addr').value,
                driverName: document.getElementById('o-drv').value,
                deliveryType: document.getElementById('o-type').value,
                targetDate: document.getElementById('o-date').value,
                targetTime: document.getElementById('o-time').value,
                lastUpdate: new Date()
            };
            if(id) await updateDoc(doc(db, "users", id), d);
            else { d.status = 1; await addDoc(collection(db, "users"), d); }
            bootstrap.Modal.getInstance(document.getElementById('orderModal')).hide();
        };

        window.done = async (id) => updateDoc(doc(db, "users", id), {status: 4});
        window.del = async (id) => { if(confirm('×œ××—×•×§ ×œ×¦××™×ª×•×ª?')) deleteDoc(doc(db, "users", id)); };

        // ×œ×§×•×—×•×ª
        window.openClientModal = () => new bootstrap.Modal(document.getElementById('clientModal')).show();
        document.getElementById('clientForm').onsubmit = async (e) => {
            e.preventDefault();
            await addDoc(collection(db, "clients"), {
                name: document.getElementById('c-name').value,
                address: document.getElementById('c-addr').value,
                type: document.getElementById('c-type').value
            });
            bootstrap.Modal.getInstance(document.getElementById('clientModal')).hide();
        };
        window.delClient = async (id) => { if(confirm('×œ××—×•×§ ×œ×§×•×—?')) deleteDoc(doc(db, "clients", id)); };

        // ×¡×˜×•×“×™×•
        window.setNewsColor = (c, el) => {
            newsColor = c;
            document.querySelectorAll('.c-dot').forEach(x => x.classList.remove('selected'));
            el.classList.add('selected');
            const map = {blue:'#0078d4', red:'#d32f2f', green:'#2e7d32'};
            document.getElementById('prev-news').style.background = map[c];
        };

        window.updateNews = async () => {
            const txt = document.getElementById('news-input').value;
            let type = 'info';
            if(newsColor === 'red') type = 'alert';
            if(newsColor === 'green') type = 'success';
            await setDoc(doc(db, "settings", "news"), { text: txt, type: type });
            alert("×”×•×“×¢×” ×¨×¦×” ×¢×•×“×›× ×” ×‘×”×¦×œ×—×”!");
        };

        window.togglePopup = async (active) => {
            const data = {
                active: active,
                title: document.getElementById('pop-title').value || '×”×•×“×¢×”',
                text: document.getElementById('pop-body').value || '...',
                icon: document.getElementById('pop-icon').value,
                theme: document.getElementById('pop-theme').value
            };
            await setDoc(doc(db, "settings", "popup"), data);
            alert(active ? "×¤×•×¤-××¤ ×©×•×“×¨!" : "×¤×•×¤-××¤ ×›×•×‘×”.");
        };

    </script>
</body>
</html>
