<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>×—.×¡×‘×Ÿ - ××¨×›×– ×©×œ×™×˜×” ×œ×•×’×™×¡×˜×™</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <style>
        :root { --whatsapp-dark: #0b141a; --whatsapp-panel: #202c33; --whatsapp-green: #008069; --urgent-red: #ff3b30; }
        body { background: var(--whatsapp-dark); color: white; margin: 0; font-family: 'Heebo', sans-serif; overflow: hidden; }
        
        .main-layout { display: grid; grid-template-columns: 1fr 1fr; height: 100vh; gap: 5px; }
        .driver-col { display: flex; flex-direction: column; background: var(--whatsapp-dark); border-left: 1px solid #333; }
        
        /* ×›×•×ª×¨×ª × ×”×’ */
        .driver-header { background: var(--whatsapp-panel); padding: 15px; display: flex; align-items: center; gap: 15px; border-bottom: 3px solid var(--whatsapp-green); }
        .driver-avatar { width: 60px; height: 60px; border-radius: 50%; object-fit: cover; border: 2px solid var(--whatsapp-green); }
        
        /* ×¦×™×¨ ×–××Ÿ */
        .timeline-scroll { flex: 1; overflow-y: auto; padding: 10px; display: flex; flex-direction: column; gap: 10px; scroll-behavior: smooth; }
        .time-slot { border-top: 1px solid #333; padding-top: 5px; color: #8696a0; font-size: 0.8rem; margin-top: 15px; }
        
        /* ×›×¨×˜×™×¡ ×”×–×× ×” */
        .order-card { background: var(--whatsapp-panel); padding: 12px; border-radius: 8px; position: relative; border-right: 4px solid #34B7F1; cursor: grab; transition: 0.3s; }
        .order-card:active { cursor: grabbing; }
        .status-blink { width: 12px; height: 12px; border-radius: 50%; display: inline-block; margin-left: 8px; }
        
        /* ×× ×™××¦×™×•×ª ×¡×˜×˜×•×¡ */
        .status-1 { background: #34B7F1; animation: blink 1.5s infinite; } /* × ×›× ×¡×” ×”×–×× ×” */
        .status-2 { background: #fbc02d; animation: blink 1s infinite; }   /* ×¢×œ×ª×” ×œ××¢×¨×›×ª */
        @keyframes blink { 0% { opacity: 1; } 50% { opacity: 0.3; } 100% { opacity: 1; } }

        /* ×›×¤×ª×•×¨ ×¤×œ×•×¡ ×¦×£ */
        .fab-add { position: fixed; bottom: 30px; left: 30px; width: 60px; height: 60px; border-radius: 50%; background: var(--whatsapp-green); color: white; border: none; font-size: 30px; cursor: pointer; box-shadow: 0 4px 10px rgba(0,0,0,0.5); z-index: 100; }
        
        /* ×¤×¡ ××©×¤×˜×™× ××ª×—×œ×¤×™× */
        .ticker-bar { position: fixed; top: 0; width: 100%; background: rgba(0,0,0,0.8); padding: 5px; color: #00a884; font-weight: bold; text-align: center; z-index: 200; border-bottom: 1px solid var(--whatsapp-green); }
    </style>
</head>
<body>

<div class="ticker-bar" id="ticker">×˜×•×¢×Ÿ × ×ª×•× ×™× ××”×©×˜×—...</div>

<div class="main-layout">
    <div class="driver-col">
        <div class="driver-header">
            <img src="https://cdn-icons-png.flaticon.com/512/2555/2555013.png" class="driver-avatar">
            <div>
                <input type="text" id="driver1-name" placeholder="×©× × ×”×’ ××©××™×ª..." style="background:none; border:none; color:white; font-size:1.2rem; font-weight:bold; outline:none;">
                <div style="font-size:0.8rem; color:#8696a0;">××©××™×ª ×—×œ×•×§×”</div>
            </div>
        </div>
        <div class="timeline-scroll" id="timeline1"></div>
    </div>

    <div class="driver-col">
        <div class="driver-header">
            <img src="https://cdn-icons-png.flaticon.com/512/2329/2329113.png" class="driver-avatar">
            <div>
                <input type="text" id="driver2-name" placeholder="×©× × ×”×’ ×× ×•×£..." style="background:none; border:none; color:white; font-size:1.2rem; font-weight:bold; outline:none;">
                <div style="font-size:0.8rem; color:#8696a0;">××©××™×ª ×× ×•×£</div>
            </div>
        </div>
        <div class="timeline-scroll" id="timeline2"></div>
    </div>
</div>

<button class="fab-add" onclick="openOrderModal()"><i class="material-icons">add</i></button>

<div id="manual-order-modal" class="modal-overlay" style="display:none; align-items:center;">
    <div class="modal-content" style="border-radius:15px;">
        <div class="modal-header"><h3>×™×¦×™×¨×ª ×”×–×× ×” ×œ×‘×™×¦×•×¢</h3><i class="material-icons" onclick="closeOrderModal()">close</i></div>
        <input type="text" id="m-cust" class="input-field" placeholder="×©× ×œ×§×•×—">
        <input type="text" id="m-city" class="input-field" placeholder="×¢×™×¨ ××¡×¤×§×”">
        <select id="m-type" class="input-field">
            <option value="×× ×•×£">×”×•×‘×œ×ª ×× ×•×£ ğŸ—ï¸</option>
            <option value="×¤×¨×™×§×” ×™×“× ×™×ª">×¤×¨×™×§×” ×™×“× ×™×ª ğŸšš</option>
        </select>
        <button onclick="createManualOrder()" class="btn-primary">×”×›× ×¡ ×œ×¦×™×¨ ×–××Ÿ</button>
    </div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore-compat.js"></script>
<script>
    // ×”×’×“×¨×•×ª Firebase ××××’×¨ ×—.×¡×‘×Ÿ
    const firebaseConfig = {
        apiKey: "AIzaSyBGYsZylsIyeWudp8_SlnLBelkgoNXjU60",
        projectId: "app-saban94-57361",
        appId: "1:275366913167:web:f0c6f808e12f2aeb58fcfa"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // ×™×¦×™×¨×ª ×¦×™×¨ ×–××Ÿ ×›×œ ×—×¦×™ ×©×¢×”
    function initTimeline() {
        const containers = ['timeline1', 'timeline2'];
        containers.forEach(id => {
            const el = document.getElementById(id);
            for(let h=6; h<=18; h++) {
                [0, 30].forEach(m => {
                    const time = `${h.toString().padStart(2, '0')}:${m.toString().padStart(2, '0')}`;
                    const slot = document.createElement('div');
                    slot.className = 'time-slot';
                    slot.innerText = time;
                    slot.id = `${id}-${time}`;
                    el.appendChild(slot);
                });
            }
        });
    }

    // ××©×¤×˜×™× ××ª×—×œ×¤×™×
    const tips = ["×¡×¢ ×‘×–×”×™×¨×•×ª, ×—.×¡×‘×Ÿ ×©×•××¨×ª ×¢×œ×™×š!", "×”×–×× ×” ×“×—×•×¤×” ×ª××™×“ ×‘×¨××© ×¡×“×¨ ×”×¢×“×™×¤×•×™×•×ª", "×•×•×“× ×—×ª×™××” ×¢×œ ×ª×¢×•×“×ª ××©×œ×•×—", "×× ×•×£: ×•×•×“× ××¨×—×§ ××§×•×•×™ ×—×©××œ"];
    let tipIdx = 0;
    setInterval(() => {
        document.getElementById('ticker').innerText = tips[tipIdx];
        tipIdx = (tipIdx + 1) % tips.length;
    }, 5000);

    // ×”××–× ×” ×œ×”×–×× ×•×ª ××œ×§×•×—×•×ª ×•×§×‘×•×¦×•×ª
    db.collection('users').onSnapshot(snap => {
        // × ×™×§×•×™ ×›×¨×˜×™×¡×™× ×§×•×“××™×
        document.querySelectorAll('.order-card').forEach(e => e.remove());
        
        snap.forEach(doc => {
            const data = doc.data();
            if(data.status && data.status < 4) {
                renderOrder(doc.id, data);
            }
        });
    });

    function renderOrder(id, data) {
        const card = document.createElement('div');
        card.className = 'order-card';
        const isCrane = data.address && data.address.includes('×× ×•×£') || data.type === 'group';
        const targetTimeline = isCrane ? 'timeline2' : 'timeline1';
        
        // ×”×“××™×™×ª ××¡×¤×¨ ×”×–×× ×” ××¨×’×•× ×™×ª
        const orgId = data.orgId || `6210${Math.floor(10 + Math.random() * 90)}`;
        
        card.innerHTML = `
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <b>${data.name || id}</b>
                <span class="status-blink status-${data.status || 1}"></span>
            </div>
            <div style="font-size:0.85rem; color:#8696a0;">ğŸ“ ${data.address || '×¢×™×¨ ×œ× ×¦×•×™× ×”'}</div>
            <div style="font-size:0.75rem; color:#34B7F1; margin-top:5px;"># ${orgId} | ${isCrane ? '×× ×•×£' : '×¤×¨×™×§×” ×™×“× ×™×ª'}</div>
        `;
        
        // ×”×¦××“×” ×œ×¦×™×¨ ×–××Ÿ (×œ×¦×•×¨×š ×”×“×’××” × ×¦××™×“ ×œ×©×¢×” ×”× ×•×›×—×™×ª)
        const now = new Date();
        const hour = now.getHours().toString().padStart(2,'0');
        const min = now.getMinutes() < 30 ? '00' : '30';
        const slot = document.getElementById(`${targetTimeline}-${hour}:${min}`);
        if(slot) slot.after(card);
    }

    function openOrderModal() { document.getElementById('manual-order-modal').style.display = 'flex'; }
    function closeOrderModal() { document.getElementById('manual-order-modal').style.display = 'none'; }

    function createManualOrder() {
        const name = document.getElementById('m-cust').value;
        const address = document.getElementById('m-city').value;
        const type = document.getElementById('m-type').value;
        
        db.collection('users').add({
            name, address, status: 1, type: 'client', lastUpdate: firebase.firestore.FieldValue.serverTimestamp(),
            manual: true, deliveryType: type
        });
        closeOrderModal();
    }

    initTimeline();
</script>
</body>
</html>
