<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>.住 -  驻爪 </title>
    <link rel="stylesheet" href="style.css">
    <style>
        body { background: #0b141a; color: white; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 0; overflow: hidden; }
        .dispatch-grid { display: grid; grid-template-columns: 1fr 1fr; height: 100vh; gap: 2px; background: #202c33; }
        .driver-column { background: #0b141a; display: flex; flex-direction: column; padding: 15px; }
        
        /* 专砖 注 - 驻专  */
        .driver-header { background: #202c33; padding: 20px; border-radius: 10px; display: flex; align-items: center; gap: 20px; margin-bottom: 20px; border-bottom: 4px solid #00a884; }
        .driver-img { width: 100px; height: 100px; border-radius: 50%; border: 3px solid #00a884; object-fit: cover; }
        .driver-info input { background: transparent; border: none; border-bottom: 1px dashed #8696a0; color: #00a884; font-size: 1.5rem; font-weight: bold; width: 200px; outline: none; }
        
        /* 爪专  转 */
        .timeline { flex-grow: 1; overflow-y: auto; padding-right: 10px; }
        .order-card { background: #202c33; margin-bottom: 15px; padding: 15px; border-radius: 8px; position: relative; border-right: 4px solid #34b7f1; animation: slideIn 0.3s ease-out; }
        .order-time { position: absolute; left: 15px; top: 15px; background: #005c4b; padding: 2px 8px; border-radius: 4px; font-size: 0.8rem; }
        .order-address { color: #8696a0; margin-top: 5px; font-size: 0.9rem; }
        
        @keyframes slideIn { from { opacity: 0; transform: translateX(20px); } to { opacity: 1; transform: translateX(0); } }
    </style>
</head>
<body>

<div class="dispatch-grid">
    <div class="driver-column" id="truck-column">
        <div class="driver-header">
            <img src="https://cdn-icons-png.flaticon.com/512/2555/2555013.png" class="driver-img" alt="砖转">
            <div class="driver-info">
                <div style="font-size: 0.9rem; color: #8696a0;"> 砖转</div>
                <input type="text" id="driver1-name" placeholder="拽 砖 ..." onchange="saveDriverName(1, this.value)">
            </div>
        </div>
        <div class="timeline" id="orders-driver1">
            </div>
    </div>

    <div class="driver-column" id="crane-column">
        <div class="driver-header">
            <img src="https://cdn-icons-png.flaticon.com/512/2329/2329113.png" class="driver-img" alt="祝">
            <div class="driver-info">
                <div style="font-size: 0.9rem; color: #8696a0;"> 祝</div>
                <input type="text" id="driver2-name" placeholder="拽 砖 ..." onchange="saveDriverName(2, this.value)">
            </div>
        </div>
        <div class="timeline" id="orders-driver2">
            </div>
    </div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore-compat.js"></script>

<script>
    // 专转 Firebase 专 砖
    const firebaseConfig = {
        apiKey: "AIzaSyBGYsZylsIyeWudp8_SlnLBelkgoNXjU60",
        projectId: "app-saban94-57361",
        appId: "1:275366913167:web:f0c6f808e12f2aeb58fcfa"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // 砖专转 砖  住住 转 (住专  住)
    function saveDriverName(id, name) {
        db.collection('settings').doc('drivers').set({
            [`driver${id}`]: name
        }, { merge: true });
    }

    // 注转 砖转  
    db.collection('settings').doc('drivers').onSnapshot(doc => {
        if (doc.exists) {
            const data = doc.data();
            if (data.driver1) document.getElementById('driver1-name').value = data.driver1;
            if (data.driver2) document.getElementById('driver2-name').value = data.driver2;
        }
    });

    //  砖驻 转 祝 :  转
    db.collection('users').orderBy('lastUpdate', 'desc').onSnapshot(snap => {
        const list1 = document.getElementById('orders-driver1');
        const list2 = document.getElementById('orders-driver2');
        list1.innerHTML = ''; list2.innerHTML = '';

        snap.forEach(doc => {
            const order = doc.data();
            // 拽: 住 转 驻 (住住 2)
            if (order.status === 2 || order.status === 3) {
                const card = document.createElement('div');
                card.className = 'order-card';
                const time = order.lastUpdate ? new Date(order.lastUpdate.toDate()).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}) : '--:--';
                
                card.innerHTML = `
                    <div class="order-time">${time}</div>
                    <div style="font-weight: bold; font-size: 1.1rem;">${order.name}</div>
                    <div class="order-address"> ${order.address || '住祝 注爪'}</div>
                    <div style="margin-top: 10px; color: #00a884; font-size: 0.8rem;"> 住住: 专</div>
                `;

                // 驻爪  驻 住  (祝/砖转)  拽 砖
                if (order.address && (order.address.includes('祝') || order.address.includes('拽'))) {
                    list2.appendChild(card);
                } else {
                    list1.appendChild(card);
                }
            }
        });
    });
</script>

</body>
</html>
