<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>.住 - 专 砖 住</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <style>
        body { background: #111b21; color: white; overflow: hidden; } /* 专拽注  拽爪注 */
        .screen-container { display: grid; grid-template-columns: 350px 1fr; height: 100vh; gap: 10px; padding: 10px; }
        .stats-panel { background: #202c33; border-radius: 15px; padding: 20px; display: flex; flex-direction: column; gap: 20px; }
        .live-feed { background: #0b141a; border-radius: 15px; overflow-y: auto; position: relative; }
        .order-card-live { background: #202c33; margin: 10px; padding: 15px; border-radius: 10px; border-right: 5px solid #00a884; animation: fadeIn 0.5s; }
        .urgent { border-right-color: #ff3b30; animation: pulse-red 2s infinite; }
        .stat-box { background: #008069; padding: 20px; border-radius: 12px; text-align: center; }
        .stat-number { font-size: 3rem; font-weight: bold; }
        @keyframes pulse-red { 0% { box-shadow: 0 0 0 0 rgba(255, 59, 48, 0.4); } 70% { box-shadow: 0 0 0 15px rgba(255, 59, 48, 0); } 100% { box-shadow: 0 0 0 0 rgba(255, 59, 48, 0); } }
    </style>
</head>
<body>
    <div class="screen-container">
        <div class="stats-panel">
            <img src="icon-192.png" style="width: 100px; align-self: center;">
            <div class="stat-box">
                <div class="stat-title">转 驻注转</div>
                <div id="active-count" class="stat-number">0</div>
            </div>
            <div class="stat-box" style="background: #fbc02d; color: black;">
                <div class="stat-title">驻 祝</div>
                <div id="urgent-count" class="stat-number">0</div>
            </div>
            <div id="clock" style="font-size: 2rem; text-align: center; margin-top: auto;">00:00:00</div>
        </div>

        <div class="live-feed" id="screen-feed">
            <div style="padding: 20px; text-align: center; color: #8696a0;">转专 住 转 砖 .住...</div>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore-compat.js"></script>
    <script>
        // 砖砖 拽驻专爪 -app.js 拽专
        const firebaseConfig = {
            apiKey: "AIzaSyBGYsZylsIyeWudp8_SlnLBelkgoNXjU60",
            projectId: "app-saban94-57361",
            appId: "1:275366913167:web:f0c6f808e12f2aeb58fcfa"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        function initScreen() {
            // 注 砖注
            setInterval(() => { document.getElementById('clock').innerText = new Date().toLocaleTimeString(); }, 1000);

            //  转 砖转砖
            db.collection('users').orderBy('lastUpdate', 'desc').onSnapshot(snap => {
                const feed = document.getElementById('screen-feed');
                feed.innerHTML = '';
                let active = 0, urgent = 0;

                snap.forEach(doc => {
                    const u = doc.data();
                    if (u.status && u.status < 4) { // 专拽 驻注
                        active++;
                        const isUrgent = u.address && u.address.includes('祝'); // 拽转  驻转
                        if (isUrgent) urgent++;

                        const card = document.createElement('div');
                        card.className = `order-card-live ${isUrgent ? 'urgent' : ''}`;
                        card.innerHTML = `
                            <div style="display:flex; justify-content:space-between;">
                                <b style="font-size:1.2rem;">${u.name}</b>
                                <span style="color:#8696a0;">${u.lastUpdate ? new Date(u.lastUpdate.toDate()).toLocaleTimeString() : ''}</span>
                            </div>
                            <div style="margin-top:10px; color:#d1d7db;"> ${u.address || ' 爪 转转'}</div>
                            <div style="margin-top:5px; font-weight:bold; color:#00a884;"> 住住: ${getStatusText(u.status)}</div>
                        `;
                        feed.appendChild(card);
                    }
                });
                document.getElementById('active-count').innerText = active;
                document.getElementById('urgent-count').innerText = urgent;
            });
        }

        function getStatusText(s) {
            const statusMap = { 1: "转拽", 2: "驻", 3: "专" };
            return statusMap[s] || "砖";
        }

        initScreen();
    </script>
</body>
</html>
