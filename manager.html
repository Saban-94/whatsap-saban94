<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>×—.×¡×‘×Ÿ - ×¡×˜×•×“×™×• × ×™×”×•×œ ××¡×›×™×</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;700;900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    
    <style>
        body {
            background-color: #121212;
            color: #e0e0e0;
            font-family: 'Heebo', sans-serif;
        }
        .studio-card {
            background-color: #1e1e1e;
            border: 1px solid #333;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.4);
        }
        .form-control, .form-select {
            background-color: #2c2c2c;
            border: 1px solid #444;
            color: #fff;
        }
        .form-control:focus, .form-select:focus {
            background-color: #333;
            color: #fff;
            border-color: #008069; /* Saban Green */
            box-shadow: none;
        }
        .btn-saban {
            background-color: #008069;
            color: white;
            font-weight: bold;
            border: none;
        }
        .btn-saban:hover { background-color: #00695c; color: white; }
        
        .live-dot {
            height: 12px; width: 12px;
            background-color: #00ff00;
            border-radius: 50%;
            display: inline-block;
            box-shadow: 0 0 10px #00ff00;
            margin-left: 8px;
        }
        
        /* Table Styles */
        .table-dark { --bs-table-bg: #1e1e1e; }
        .status-badge { padding: 4px 8px; border-radius: 4px; font-size: 0.8rem; }
        .st-1 { background: #34B7F1; color: white; } /* ×—×“×© */
        .st-2 { background: #fbc02d; color: black; } /* ×‘×˜×™×¤×•×œ */
        .st-3 { background: #00e676; color: black; } /* ×‘×“×¨×š */
    </style>
</head>
<body class="p-4">

    <div class="container-fluid" style="max-width: 1400px;">
        <div class="d-flex justify-content-between align-items-center mb-5">
            <h2 class="fw-bold text-white"><span class="live-dot"></span> ×—.×¡×‘×Ÿ ××¢×¨×›×•×ª - ×¡×˜×•×“×™×• ×©×™×“×•×¨</h2>
            <div class="text-muted small">××—×•×‘×¨ ×œ×¤×¨×•×™×§×˜: app-saban94-57361</div>
        </div>

        <div class="row g-4">
            
            <div class="col-12">
                <div class="studio-card p-4">
                    <h4 class="mb-3 d-flex align-items-center"><i class="material-icons ms-2 text-danger">campaign</i> ×¢×“×›×•×Ÿ ×¤×¡ ×—×“×©×•×ª (Ticker)</h4>
                    <div class="input-group">
                        <span class="input-group-text bg-danger text-white border-0">×”×•×“×¢×” ×—×™×”:</span>
                        <input type="text" id="tickerInput" class="form-control" placeholder="×”×§×œ×“ ×”×•×“×¢×” ×©×ª×¨×•×¥ ×‘×ª×—×ª×™×ª ×”××¡×š...">
                        <button class="btn btn-danger" onclick="updateTicker()">×¢×“×›×Ÿ ××¡×›×™× ××™×™×“×™×ª</button>
                        <button class="btn btn-outline-secondary" onclick="clearTicker()">× ×§×”</button>
                    </div>
                </div>
            </div>

            <div class="col-md-4">
                <div class="studio-card p-4 h-100">
                    <h4 class="mb-4 text-success"><i class="material-icons ms-2">add_circle</i> ×”×–×× ×” ×—×“×©×” ×œ×œ×•×—</h4>
                    <form id="orderForm">
                        <div class="mb-3">
                            <label class="form-label text-muted">×©× ×œ×§×•×— / ×¤×¨×•×™×§×˜</label>
                            <input type="text" id="clientName" class="form-control" required placeholder="×œ××©×œ: ×¨×•× ×™ ×§×‘×œ×Ÿ">
                        </div>
                        <div class="mb-3">
                            <label class="form-label text-muted">×›×ª×•×‘×ª / ××™×§×•×</label>
                            <input type="text" id="address" class="form-control" placeholder="×œ××©×œ: ×”×¨×¦×œ 55, × ×ª× ×™×”">
                        </div>
                        <div class="mb-3">
                            <label class="form-label text-muted">×¡×•×’ ×¢×‘×•×“×”</label>
                            <select id="type" class="form-select">
                                <option value="××›×•×œ×” 8 ×§×•×‘">ğŸ—‘ï¸ ××›×•×œ×” 8 ×§×•×‘</option>
                                <option value="××›×•×œ×” 24 ×§×•×‘">ğŸ—‘ï¸ ××›×•×œ×” 24 ×§×•×‘</option>
                                <option value="×× ×•×£ 10 ××˜×¨">ğŸ—ï¸ ×× ×•×£ 10 ××˜×¨</option>
                                <option value="×× ×•×£ 15 ××˜×¨">ğŸ—ï¸ ×× ×•×£ 15 ××˜×¨</option>
                                <option value="××©××™×ª ×—×•××¨×™×">ğŸšš ××©××™×ª ×—×•××¨×™×</option>
                            </select>
                        </div>
                        <div class="mb-4">
                             <label class="form-label text-muted">×“×—×™×¤×•×ª</label>
                             <select id="urgency" class="form-select">
                                 <option value="false">×¨×’×™×œ</option>
                                 <option value="true">ğŸ”¥ ×“×—×•×£ ×××•×“</option>
                             </select>
                        </div>
                        <button type="submit" class="btn btn-saban w-100 py-2">×©×œ×— ×œ××¡×›×™× ğŸš€</button>
                    </form>
                </div>
            </div>

            <div class="col-md-8">
                <div class="studio-card p-4 h-100">
                    <div class="d-flex justify-content-between mb-3">
                        <h4 class="text-info"><i class="material-icons ms-2">monitor</i> ×ª×¦×•×’×” ×—×™×” (××” ×¨×•××™× ×‘××¡×š)</h4>
                        <span class="badge bg-secondary" id="count-badge">0 ×”×–×× ×•×ª</span>
                    </div>
                    <div class="table-responsive">
                        <table class="table table-dark table-hover align-middle">
                            <thead>
                                <tr class="text-muted">
                                    <th>×œ×§×•×—</th>
                                    <th>××™×§×•×</th>
                                    <th>×¡×•×’</th>
                                    <th>×¡×˜×˜×•×¡</th>
                                    <th>× ×™×”×•×œ</th>
                                </tr>
                            </thead>
                            <tbody id="ordersTableBody">
                                </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, doc, setDoc, onSnapshot, query, orderBy, deleteDoc, updateDoc, serverTimestamp } 
        from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // --- 1. ×”×—×™×‘×•×¨ ×©×œ×š (× ×œ×§×— ××ª×•×š app.js) ---
        const firebaseConfig = {
            apiKey: "AIzaSyBGYsZylsIyeWudp8_SlnLBelkgoNXjU60",
            authDomain: "app-saban94-57361.firebaseapp.com",
            projectId: "app-saban94-57361",
            storageBucket: "app-saban94-57361.firebasestorage.app",
            messagingSenderId: "275366913167",
            appId: "1:275366913167:web:f0c6f808e12f2aeb58fcfa",
            measurementId: "G-E297QYKZKQ"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // --- 2. ×œ×•×’×™×§×” ×œ×¤×¡ ×—×“×©×•×ª (Ticker) ---
        // ×× ×—× ×• × ×©××•×¨ ××ª ×–×” ×‘-Collection × ×¤×¨×“ ×‘×©× 'settings'
        window.updateTicker = async () => {
            const text = document.getElementById('tickerInput').value;
            if(!text) return;
            
            try {
                await setDoc(doc(db, "settings", "ticker"), {
                    message: text,
                    active: true,
                    lastUpdate: serverTimestamp()
                });
                alert("×”×¤×¡ ×¢×•×“×›×Ÿ!");
            } catch (e) { console.error(e); alert("×©×’×™××” ×‘×¢×“×›×•×Ÿ"); }
        }

        window.clearTicker = async () => {
             await updateDoc(doc(db, "settings", "ticker"), { message: "", active: false });
             document.getElementById('tickerInput').value = "";
        }

        // --- 3. ×©×œ×™×—×ª ×”×–×× ×” ×—×“×©×” (×ª×•×× ×œ××¢×¨×›×ª ×”×§×™×™××ª users) ---
        document.getElementById('orderForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const btn = e.target.querySelector('button');
            btn.innerHTML = "×©×•×œ×—..."; btn.disabled = true;

            const isUrgent = document.getElementById('urgency').value === "true";
            
            const newOrder = {
                name: document.getElementById('clientName').value,       // ×ª×•×× ×œ×©×“×•×ª ×‘-tv.html
                address: document.getElementById('address').value,
                deliveryType: document.getElementById('type').value,
                status: 1, // 1 = ×—×“×©
                type: 'client', // ×›×“×™ ×©×™×•×¤×™×¢ ×‘××¡× × ×™× ×”×§×™×™××™×
                serviceType: document.getElementById('type').value.includes('××›×•×œ×”') ? 'container' : 'material',
                isUrgent: isUrgent,
                lastUpdate: serverTimestamp(),
                // ×× ×“×—×•×£, × ×•×¡×™×£ ×”×¢×¨×” ×œ×›×•×ª×¨×ª
                notes: isUrgent ? "×“×—×•×£ ×××•×“!" : ""
            };

            await addDoc(collection(db, "users"), newOrder);
            
            // ××™×¤×•×¡
            e.target.reset();
            btn.innerHTML = "×©×œ×— ×œ××¡×›×™× ğŸš€"; btn.disabled = false;
        });

        // --- 4. ×˜×‘×œ×” ×—×™×” (××§×©×™×‘ ×œ××•×¡×£ users) ---
        const q = query(collection(db, "users"), orderBy("lastUpdate", "desc"));
        
        onSnapshot(q, (snapshot) => {
            const tbody = document.getElementById('ordersTableBody');
            tbody.innerHTML = "";
            let count = 0;

            snapshot.forEach((docSnap) => {
                const d = docSnap.data();
                // × ×¦×™×’ ×¨×§ ×”×–×× ×•×ª ×¤×¢×™×œ×•×ª (×œ× ××¨×›×™×•×Ÿ)
                if (d.status === 4) return;

                count++;
                const row = document.createElement('tr');
                if(d.isUrgent) row.style.borderLeft = "4px solid #ff3b30";

                let statusBadge = '';
                if(d.status == 1) statusBadge = '<span class="status-badge st-1">×××ª×™×Ÿ</span>';
                if(d.status == 2) statusBadge = '<span class="status-badge st-2">×‘×˜×™×¤×•×œ</span>';
                if(d.status == 3) statusBadge = '<span class="status-badge st-3">×‘×“×¨×š</span>';

                row.innerHTML = `
                    <td class="fw-bold">${d.name}</td>
                    <td>${d.address || '-'}</td>
                    <td>${d.deliveryType || '×›×œ×œ×™'}</td>
                    <td>${statusBadge}</td>
                    <td>
                        <button class="btn btn-sm btn-outline-danger" onclick="archiveOrder('${docSnap.id}')">
                            <i class="material-icons" style="font-size:16px;">delete</i> ××¨×›×‘
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
            document.getElementById('count-badge').innerText = count + " ×”×–×× ×•×ª ×¤×¢×™×œ×•×ª";
        });

        // ×¤×•× ×§×¦×™×™×ª ××—×™×§×” (×”×¢×‘×¨×” ×œ××¨×›×™×•×Ÿ ×¡×˜×˜×•×¡ 4)
        window.archiveOrder = async (id) => {
            if(confirm("×”×× ×œ××¨×›×‘ ×”×–×× ×” ×–×•? (×ª×¨×“ ××”××¡×š)")) {
                await updateDoc(doc(db, "users", id), { status: 4 });
            }
        }
    </script>
</body>
</html>
