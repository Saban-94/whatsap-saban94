<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>×—.×¡×‘×Ÿ - ×¡×˜×•×“×™×• ×©×™×“×•×¨</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <style>
        body { background-color: #121212; color: #e0e0e0; font-family: 'Segoe UI', sans-serif; }
        .studio-card { background-color: #1e1e1e; border: 1px solid #333; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.4); }
        .form-control, .form-select { background-color: #2c2c2c; border: 1px solid #444; color: #fff; }
        .form-control:focus, .form-select:focus { background-color: #333; color: #fff; border-color: #008069; box-shadow: none; }
        .btn-saban { background-color: #008069; color: white; fontWeight: bold; border: none; }
        .btn-saban:hover { background-color: #00695c; color: white; }
    </style>
</head>
<body class="p-4">
    <div class="container-fluid" style="max-width: 1200px;">
        <h2 class="fw-bold text-white mb-4">ğŸ›ï¸ ×¡×˜×•×“×™×• × ×™×”×•×œ - ×—.×¡×‘×Ÿ</h2>

        <div class="row g-4">
            <div class="col-md-4">
                <div class="studio-card p-4">
                    <h4 class="mb-4 text-success">×”×–×× ×” ×—×“×©×”</h4>
                    <form id="orderForm">
                        <div class="mb-3">
                            <label class="text-muted">×œ×§×•×—</label>
                            <input type="text" id="clientName" class="form-control" required placeholder="×©× ×”×œ×§×•×—">
                        </div>
                        <div class="mb-3">
                            <label class="text-muted">×›×ª×•×‘×ª (×¢×™×¨ ×•×¨×—×•×‘)</label>
                            <input type="text" id="address" class="form-control" required placeholder="×œ××©×œ: ×•×™×¦××Ÿ 10, ×—×“×¨×”">
                        </div>
                        <div class="mb-3">
                            <label class="text-muted">×¡×•×’ ×”×•×‘×œ×”</label>
                            <select id="type" class="form-select">
                                <option value="×× ×•×£ 10 ××˜×¨">ğŸ—ï¸ ×× ×•×£ 10 ××˜×¨</option>
                                <option value="×× ×•×£ 15 ××˜×¨">ğŸ—ï¸ ×× ×•×£ 15 ××˜×¨</option>
                                <option value="××›×•×œ×” 8 ×§×•×‘">ğŸ—‘ï¸ ××›×•×œ×” 8 ×§×•×‘</option>
                                <option value="××›×•×œ×” 24 ×§×•×‘">ğŸ—‘ï¸ ××›×•×œ×” 24 ×§×•×‘</option>
                                <option value="××©××™×ª ×—×•××¨×™×">ğŸšš ××©××™×ª ×—×•××¨×™×</option>
                            </select>
                        </div>
                        
                        <div class="row mb-3">
                            <div class="col-6">
                                <label class="text-muted">×ª××¨×™×š ×‘×™×¦×•×¢</label>
                                <input type="date" id="dateInput" class="form-control">
                            </div>
                            <div class="col-6">
                                <label class="text-muted">×©×¢×ª ×™×¢×“ (×˜×™×™××¨)</label>
                                <input type="time" id="timeInput" class="form-control">
                            </div>
                        </div>

                        <div class="mb-4">
                             <label class="text-muted">×“×—×™×¤×•×ª</label>
                             <select id="urgency" class="form-select">
                                 <option value="false">×¨×’×™×œ</option>
                                 <option value="true">ğŸ”¥ ×“×—×•×£ ×××•×“</option>
                             </select>
                        </div>
                        <button type="submit" class="btn btn-saban w-100 py-2">×©×’×¨ ×œ××¤×” ğŸš€</button>
                    </form>
                </div>
            </div>

            <div class="col-md-8">
                <div class="studio-card p-4">
                    <h4 class="text-info">×”×–×× ×•×ª ×—×™×•×ª ×‘××¢×¨×›×ª</h4>
                    <table class="table table-dark table-hover mt-3">
                        <thead><tr><th>×œ×§×•×—</th><th>×™×¢×“</th><th>×–××Ÿ</th><th>× ×™×”×•×œ</th></tr></thead>
                        <tbody id="ordersTableBody"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, doc, onSnapshot, query, orderBy, updateDoc, serverTimestamp } 
        from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBGYsZylsIyeWudp8_SlnLBelkgoNXjU60",
            authDomain: "app-saban94-57361.firebaseapp.com",
            projectId: "app-saban94-57361",
            storageBucket: "app-saban94-57361.firebasestorage.app",
            messagingSenderId: "275366913167",
            appId: "1:275366913167:web:f0c6f808e12f2aeb58fcfa"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // ×§×‘×™×¢×ª ×ª××¨×™×š ×‘×¨×™×¨×ª ××—×“×œ ×œ×”×™×•×
        document.getElementById('dateInput').valueAsDate = new Date();

        document.getElementById('orderForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const btn = e.target.querySelector('button');
            btn.innerHTML = "×©×•×œ×—..."; btn.disabled = true;

            const newOrder = {
                name: document.getElementById('clientName').value,
                address: document.getElementById('address').value,
                deliveryType: document.getElementById('type').value,
                targetDate: document.getElementById('dateInput').value,
                targetTime: document.getElementById('timeInput').value, // ×©×¢×” ×œ×˜×™×™××¨
                status: 1, 
                isUrgent: document.getElementById('urgency').value === "true",
                lastUpdate: serverTimestamp()
            };

            await addDoc(collection(db, "users"), newOrder);
            e.target.reset();
            document.getElementById('dateInput').valueAsDate = new Date(); // ××™×¤×•×¡ ×ª××¨×™×š ×œ×”×™×•×
            btn.innerHTML = "×©×’×¨ ×œ××¤×” ğŸš€"; btn.disabled = false;
        });

        // ×”××–× ×” ×œ×˜×‘×œ×”
        const q = query(collection(db, "users"), orderBy("lastUpdate", "desc"));
        onSnapshot(q, (snapshot) => {
            const tbody = document.getElementById('ordersTableBody');
            tbody.innerHTML = "";
            snapshot.forEach((docSnap) => {
                const d = docSnap.data();
                if (d.status === 4) return;
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${d.name}</td>
                    <td>${d.address}</td>
                    <td>${d.targetTime || '-'}</td>
                    <td><button class="btn btn-sm btn-outline-danger" onclick="archiveOrder('${docSnap.id}')">××—×§</button></td>
                `;
                tbody.appendChild(row);
            });
        });

        window.archiveOrder = async (id) => {
            if(confirm("×œ××—×•×§?")) await updateDoc(doc(db, "users", id), { status: 4 });
        }
    </script>
</body>
</html>
