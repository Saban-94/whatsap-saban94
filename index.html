<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ח.סבן חומרי בנין</title>
    <link rel="icon" type="image/png" href="https://cdn-icons-png.flaticon.com/512/1041/1041883.png">
    <link rel="stylesheet" href="style.css">
    <link rel="manifest" href="manifest.json">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.onesignal.com/sdks/web/v16/OneSignalSDK.page.js" defer></script>
</head>
<body>

    <header class="app-header" id="main-header">
        <div class="user-info" id="header-user-info">
            <img src="https://ui-avatars.com/api/?name=S&background=random" id="header-avatar" class="avatar-large">
            <div class="header-text">
                <span id="app-title">ח.סבן חומרי בנין</span>
                <div id="sub-title">
                    <span id="status-text">טוען...</span>
                    <div id="participants-bar" class="participants-bar"></div>
                </div>
            </div>
        </div>
        <div class="actions">
            <i class="material-icons" id="refresh-btn">refresh</i>
            <i class="material-icons" id="back-btn" style="display:none;">arrow_forward</i>
        </div>
    </header>

    <div id="stories-container">
        <div class="progress-track"></div>
        <div class="progress-fill" id="progress-fill"></div>
        </div>

    <div id="staff-dashboard" style="display:none;">
        <div class="dashboard-gates">
            <div class="gate-card active-filter" onclick="filterDashboard('active')">
                <div class="gate-icon"><i class="material-icons">local_shipping</i></div>
                <div class="gate-stat" id="stat-active">0</div>
                <div class="gate-title">הזמנות חיות</div>
            </div>
            <div class="gate-card" onclick="filterDashboard('history')">
                <div class="gate-icon"><i class="material-icons">inventory</i></div>
                <div class="gate-stat" id="stat-history">0</div>
                <div class="gate-title">ארכיון</div>
            </div>
        </div>

        <div id="clients-list">
            </div>

        <div class="fab-menu-container" id="fab-menu">
            <div class="mini-fab" onclick="openUserModal('client')">
                <i class="material-icons">person_add</i>
                <span class="fab-label">לקוח חדש</span>
            </div>
            <div class="mini-fab" onclick="openUserModal('staff')">
                <i class="material-icons">badge</i>
                <span class="fab-label">איש צוות</span>
            </div>
        </div>
    </div>

    <div id="admin-controls" class="admin-controls" style="display:none;">
        <button onclick="updateStatus(1)" class="control-btn"><i class="material-icons">receipt</i> התקבל</button>
        <button onclick="updateStatus(2)" class="control-btn"><i class="material-icons">handyman</i> בטיפול</button>
        <button onclick="updateStatus(3)" class="control-btn"><i class="material-icons">local_shipping</i> בדרך</button>
        <button onclick="updateStatus(4)" class="control-btn"><i class="material-icons">check_circle</i> סופקה</button>
        <button onclick="toggleTag('urgent')" class="control-btn" style="color:red"><i class="material-icons">error</i> דחוף</button>
    </div>

    <main id="chat-container" class="chat-feed">
        <div class="date-divider">היום</div>
    </main>

    <footer class="input-area" id="input-area">
        <button id="main-fab" class="fab-main"><i class="material-icons">add</i></button>
        
        <div class="input-wrapper">
            <input type="text" placeholder="הקלד הודעה..." id="msg-input">
            <i class="material-icons" id="internal-msg-btn" style="display:none; color:#fbc02d;" title="הערה חסויה">lock</i>
            <i class="material-icons" style="color:var(--primary-color); cursor:pointer;" id="send-btn">send</i>
        </div>
    </footer>

    <div id="order-modal" class="modal-overlay" style="display:none;">
        <div class="modal-content">
            <div class="modal-header"><h3>הזמנה חדשה 📦</h3><i class="material-icons" onclick="closeModal('order-modal')">close</i></div>
            <div class="form-group"><label>שם איש קשר</label><input type="text" id="order-contact"></div>
            <div class="form-group"><label>כתובת</label><input type="text" id="order-address"></div>
            <div class="form-group"><label>מה להזמין?</label><textarea id="order-item" rows="3"></textarea></div>
            <div class="form-group"><label>דחיפות</label>
                <select id="order-time"><option>דחוף להיום 🔥</option><option>מחר בבוקר ☀️</option><option>רגיל 🚛</option></select>
            </div>
            <button id="submit-order-btn" class="full-width-btn">שלח הזמנה</button>
        </div>
    </div>

    <div id="user-modal" class="modal-overlay" style="display:none;">
        <div class="modal-content">
            <div class="modal-header"><h3 id="user-modal-title">הוספת משתמש</h3><i class="material-icons" onclick="closeModal('user-modal')">close</i></div>
            <div class="form-group"><label>מזהה (ID)</label><input type="text" id="new-user-id" placeholder="למשל: 60123 או driver_moshe"></div>
            <div class="form-group"><label>שם תצוגה</label><input type="text" id="new-user-name" placeholder="שם מלא"></div>
            <div class="form-group"><label>סוג</label>
                <select id="new-user-role">
                    <option value="client">לקוח</option>
                    <option value="staff">איש צוות (נהג/מחסנאי)</option>
                    <option value="admin">מנהל</option>
                </select>
            </div>
            <button id="save-user-btn" class="full-width-btn">שמור משתמש</button>
            <button id="delete-user-btn" class="full-width-btn" style="background:#d32f2f; margin-top:10px; display:none;">מחק משתמש</button>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore-compat.js"></script>
    <script src="app.js"></script>
</body>
</html>
